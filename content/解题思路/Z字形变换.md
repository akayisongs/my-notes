![[Pasted image 20250612085129.png]]
### 思路：
这道题目核心规律在于其周期性运动轨迹，当我们仔细观察字符的移动路径，会发现它实际上形成一个类似"N"字的周期性循环，**这样的运动周期有什么特性呢**？观察可以发现这个***运动轨迹的完整周期长度***是`2*行数-2`，理解这个周期性特征至关重要，因为它让我们能够预判字符在垂直方向上的分布规律。**那么如何高效模拟字符放置过程呢**？最直观的方法是创建虚拟行容器：想象有n（行数）个空桶，从第0行开始向下放置字符，触底后转为向上移动，碰到顶部再次转向，如此循环往复，**那么如何控制触顶触底转向的操作呢**？可以通过设置方向标志，用1表示向下运动，-1表示向上运动，结合当前行计数器实现自动转向，***转向机制的具体触发则由边界条件控制***：当抵达第0行（顶部）时立即改为向下运动；当触及行数-1行（底部）时则转为向斜上运动。但需特别注意当行数等于1时的特殊情况，此时无需转向直接线性排列即可。**至于内存我们又应该如何进行比较简便的分配呢**？我们这里可以直接简单地使用固定分配字符串长度加一的方式来解决，免去了比较复杂的计算（当然也可稍作改进，算出行数与最长字符串序列的关系来减少空间的浪费），最终生成结果字符串时，用位置索引追踪进度并以'\0'终止符收尾。
### 细节：
- **为何要为每行分配len+1空间？**
    这是安全优先的设计原则，虽然好像每行字符数不超过ceil(len/numRows)，但实际分布不均，中间行字符数约是首尾行的两倍。分配len+1空间能确保绝对不越界，避免复杂的数学计算。*虽然稍微有些浪费内存，但相比代码健壮性，稳定性，这是值得的权衡，何况最后还会统一释放内存。*
- **为何想到用创建虚拟行容器的方式来模拟字符放置的过程的呢?**
    这是观察发现该放置过程中，*仿佛有两个不同的变化过程：第一个是字符的放置是连续的，第二个是水平方向上的字符放置是周期间断的*，所以肯定有一个控制其向某方向运动的“部件”，观察发现这里的上下边界即是水平方向是否运动关键，利用好就能解决了。
### 步骤：
 1. 先处理特殊情况，若行数为1或字符串长度不超过行数，直接返回原字符串，避免不必要的计算；
 2. 初始化核心变量：创建行指针数组存储每行字符，定义行长度计数器数组并初始化为零，设置当前行索引从0开始，方向标志初始为1（表示向下移动）；
 3. 遍历字符串中的每个字符：将当前字符添加至当前行缓冲区末尾并更新行长度计数器；
 4. 检查边界条件，若当前行为首行则确保向下移动，若为末行则转为向上移动；根据方向标志更新当前行索引（向下时行号加1，向上时行号减1）；
 5. 完成遍历后进入结果组装阶段：分配结果字符串所需内存，按行顺序（从第0行到末行）将各行字符依次复制到结果缓冲区，同时添加字符串终止符'\0'。
下面是代码的具体实现：
![[Pasted image 20250612170355.png]]
### 知识点：
字符串