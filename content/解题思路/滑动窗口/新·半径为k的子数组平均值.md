![[Pasted image 20250905144920.png]]
## 思路：
当我看到这道题时，我的第一反应是直接模拟。题目让我求什么，我就做什么。它要求以 `i` 为中心的 `k` 半径平均值，那我就遍历每一个 `i` 作为中心点。对于每一个 `i`，我先检查它的左右两边是否各有 `k` 个元素，如果不够，那这个点的平均值就是 `-1`，这很简单。如果够，我就再用一个循环，把从 `i-k` 到 `i+k` 这个区间内的所有数字加起来，得到总和，然后除以区间长度 `2*k+1`。这个方法逻辑清晰，代码也好写。但写之前我习惯性地想了一下复杂度。==这样做的时间复杂度是多少呢？==外层循环遍历所有中心点，是 `n` 次，内层循环求和，是 `2k+1` 次，总的复杂度是 O(n_k)。在刷题的经验告诉我，这个复杂度在 `n` 和 `k` 很大时，几乎是必超时的。肯定有重复计算的地方可以优化。==那么，重复计算发生在哪里呢？==当我计算完 `i` 中心的平均值，再去计算 `i+1` 中心的平均值时，我发现它们的计算窗口高度重合。窗口整体向右平移了一格，仅仅是最左边的 `nums[i-k]` 出去了，最右边的 `nums[i+1+k]` 进来了。==我何必把中间那一大段重合的数字再加一遍呢？==这启发了我，我可以用一个“滑动窗口”来解决。我可以先计算出第一个有效窗口，也就是以 `k` 为中心的那个窗口的总和。然后，当窗口向右滑动到下一个中心点 `k+1` 时，我只需要在上一个窗口总和的基础上，减去刚刚滑出窗口的数字 `nums[0]`，再加上新滑入窗口的数字 `nums[2*k+1]`，就能用常数时间更新总和。我只需要这样一路计算下去，直到窗口滑动到数组末尾。这样，我只需要一次遍历来初始化第一个窗口，再用一次遍历来滑动整个窗口，总的时间复杂度就从 O(n_k) 优化到了 O(n)，这下就肯定能通过了。最后，我还得注意一个细节，就是窗口内数字的总和可能会非常大，超出普通 `int` 的范围，所以用 `long long` 来保存总和会更保险。
## 细节：
- 有哪些必须处理的边界和细节问题？
	- **窗口无法形成的情况**：对于数组开头和结尾的那些元素（具体来说，是下标小于 `k` 或下标大于等于 `n-k` 的元素），它们的某一边或两边凑不够 `k` 个元素，无法形成一个完整的窗口。按照题目要求，这些位置的平均值应直接置为 `-1`。
	- **整型溢出风险**：窗口内所有元素的总和可能会非常大，超出普通 32 位整型 (`int`) 的最大表示范围。为了防止计算出错，必须使用 64 位长整型 (`long long`) 来存储这个总和。
## 步骤：
1. 处理特殊情况（Edge Cases） 处理 k=0：如果半径 k 是 0，那么每个元素的 k 半径平均值就是它自身。直接返回原数组的一个副本即可。
	处理无法形成窗口：计算窗口大小 windowSize = 2 * k + 1。如果数组的长度 numsSize 小于这个窗口大小，那就意味着数组里任何一个元素都无法形成一个完整的 k 半径窗口。在这种情况下，直接返回一个所有元素都为 -1 的数组。

2. 初始化 创建结果数组：创建一个和原数组 nums 等长的结果数组 avgs。
	预填充为 -1：将 avgs 数组的所有元素都初始化为 -1。这样做的好处是，我们无需再单独处理那些因为靠近数组边界而无法形成完整窗口的元素，它们会自然地保留这个默认值 -1。

3. 计算第一个窗口的和 确定首个窗口：第一个能形成完整窗口的中心点是下标 k，其对应的窗口范围是从下标 0 到 2 * k。
	计算初始总和：声明一个 long long 类型的变量 windowSum（防止溢出），然后写一个循环，累加从 nums[0] 到 nums[2 * k] 的所有元素，得到初始的窗口总和。

4. 滑动窗口并计算所有平均值 存入首个平均值：用上一步得到的 windowSum 除以窗口大小 2 * k + 1，将结果存入 avgs[k]。
	开始滑动：写一个主循环，让窗口的中心点从 k+1 开始，一直移动到最后一个有效的位置 numsSize - 1 - k。
	高效更新总和：在每次循环中，通过“减去离开的，加上新来的”方式来更新 windowSum。具体公式为：windowSum = windowSum - nums[i-k-1] + nums[i+k]（其中 i 是当前循环的中心点）。
	计算并存入新平均值：用更新后的 windowSum 计算出当前中心点 i 的平均值，并存入 avgs[i]。

5. 返回结果 循环结束后，avgs 数组就已经被正确地填充完毕了，将它作为最终结果返回。
下面是代码的具体实现：![[Pasted image 20250906172338.png]]
![[Pasted image 20250906172404.png]]
## 知识点：
滑动窗口、数组