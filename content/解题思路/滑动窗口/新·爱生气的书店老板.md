![[Pasted image 20250908102238.png]]
## 思路：
当我看到这道题时，我的第一反应是，最终的结果，也就是满意顾客的总数，应该是由两部分组成的。**那么，是哪两部分呢？** 一部分是老板在不使用秘密技巧时，本来就不生气，因此顾客天然就满意的数量。另一部分是，老板本来是生气的，但通过使用持续 minutes 分钟的秘密技巧，使得这部分时间内的顾客也变得满意了。我们的目标，就是让这两部分的总和最大。第一部分，也就是那些“基础”满意顾客数，是固定不变的。
**我应该如何计算这个基础值呢？** 很简单，我只需要遍历一次整个 customers 数组，在遍历到第 i 分钟时，如果 grumpy[i] 的值是0，就说明老板在这一分钟不生气，那么 customers[i] 这部分顾客就是满意的，我把他们累加到一个变量（比如叫 base）里。遍历结束后，base 就存储了所有必然满意的顾客总数。接下来就是解题的关键了，如何处理第二部分，也就是通过秘密技巧额外增加的满意顾客数。这个技巧只能用一次，并且持续 minutes 分钟。
**这意味着我需要在整个时间跨度中，找到一个长度为 minutes 的连续区间，来使用这个技巧，从而挽回最多的顾客。我该如何找到这个最优的区间呢？** 一个朴素的想法是，我把所有长度为 minutes 的区间都找出来，计算在每个区间内，如果用了技巧能额外挽回多少顾客，然后取一个最大值。但这样计算会有很多重复。一个更高效的方法是使用“滑动窗口”。
**滑动窗口具体要怎么实现呢？** 我可以先计算出第一个窗口，也就是从第0分钟到第 minutes-1 分钟这个区间，能挽回的顾客数。这个挽回的顾客数就是这个区间内所有 grumpy[i] 等于1的 customers[i] 之和。然后，我让这个窗口向右滑动一格，也就是考察第1分钟到第 minutes 分钟的区间。相比于前一个窗口，新的窗口增加了一个新的元素 customers[minutes]，同时移除了一个旧的元素 customers[0]。我只需要在之前窗口的基础上，加上新进入的元素（如果老板在 minutes 这分钟是生气的），再减去滑出窗口的元素（如果老板在第0分钟是生气的），就能快速得到新窗口能挽回的顾客数，而不需要重新遍历。我一边滑动窗口，一边用一个变量（比如 maxExtra）记录下所有窗口中能挽回顾客数的最大值。
## 细节：
- 如何找到“能挽回的最大不确定性收益”？
    这个问题可以转化为：在 customers 数组中，找到一个长度为 minutes 的连续子数组（窗口），使得这个窗口内所有 grumpy 值为1的对应 customers 数量之和最大。这个最大和就是我们能挽回的最大收益。
## 步骤：
#### 1. 初始化状态变量

- **创建基础满意数**: 定义一个变量 `base`，首先完整遍历一次数组，累加所有在 `grumpy[i] == 0` 条件下的 `customers[i]`。这部分是固定收益，可以直接先计算出来。
    
- **创建窗口和**: 定义一个变量 `extra` (或 `current_extra_sum`) 用于累加当前窗口内因老板生气而可以被挽回的顾客数，并将其初始化为0。
    
- **创建最大收益**: 定义一个变量 `maxExtra` 用于统计符合条件的窗口中，`extra` 能达到的最大值，并将其初始化为0。
#### 2. 启动单循环遍历

- 使用一个 `for` 循环，让索引 `i` 从 `0` 开始，遍历整个输入的 `customers` 数组直到结束。
    
- 这个单一的循环将同时负责窗口的初始填充和后续的滑动过程。
#### 3. 在循环内累加元素并填充窗口

- 在每次循环开始时，首先判断当前分钟 `i` 的老板是否生气。
    
- 如果 `grumpy[i]` 的值为 `1`，则将当前元素 `customers[i]` 的值累加到窗口和 `extra` 中。
#### 4. 在窗口满后进行计算和判断

- 当索引 `i` 大于等于 `minutes - 1` 后，每次循环都代表着一个完整的、长度为 `minutes` 的窗口形成，此时执行以下操作：
    
- **比较并更新最大值**: 将当前窗口的可挽回收益 `extra` 与记录的最大收益 `maxExtra` 进行比较。如果 `extra` 更大，则更新 `maxExtra` 的值为 `extra`。
#### 5. 更新窗口和（“滑动”）

- 在完成对当前窗口的判断之后，为下一次迭代做准备，需要将即将离开窗口的元素移除。
    
- 从 `extra` 中减去即将离开窗口的最左边的元素 `customers[i - minutes + 1]` 的影响。此操作的前提是，该离开的元素在当时 `grumpy` 数组中的值为 `1`。
下面是代码的具体实现：

![[Pasted image 20250908195921.png]]
![[Pasted image 20250908195949.png]]
### 知识点：
滑动窗口、数组